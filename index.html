<!DOCTYPE html>
<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>GateSim</title>

    <link rel="stylesheet" href="css/foundation.css">
    <link rel="stylesheet" href="css/foundation-changes.css">


    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
    <script type="text/javascript" src="js/lib/jquery-ui-1.10.3.custom.min.js"></script>
    <script type="text/javascript" src="js/lib/zepto.js"></script>
    <script type="text/javascript" src="js/lib/foundation.min.js"></script>
    <script type="text/javascript" src="js/lib/fabric.js"></script>
    <script type="text/javascript" src="js/ui/views/templates/templatefactory.js"></script>

        <script type="text/javascript">
        $(function() {
        var lastMoved;

        $(".slider").click(function() {
          var pane = $("#" + $(this).data("pane"));

          if (typeof(lastMoved) === "undefined" || !lastMoved) {
            pane.slideDown("fast", function() {});
            lastMoved = pane;
          } else if (lastMoved.is(pane)) {
            lastMoved.slideUp("fast", function(){});
            lastMoved = null;
          } else {
            lastMoved.slideUp("fast", function(){});
            pane.slideDown("fast", function() {});
            lastMoved = pane;
          }
        });
    });
    </script>
  

    <script type="text/javascript" src="js/lib/custom.modernizr.js"></script>
    <script type="text/javascript" src="js/lib/underscore-min.js"></script>
    <script type="text/javascript" src="js/lib/backbone-min.js"></script>
    <script type="text/javascript" src="js/ui/models/component.js"></script>
    <script type="text/javascript" src="js/ui/collections/componentset.js"></script>
    <script type="text/javascript" src="js/ui/models/circuit.js"></script>
    <script type="text/javascript" src="js/ui/views/componentview.js"></script>
    <script type="text/javascript" src="js/ui/views/componentsetview.js"></script>
    <script type="text/javascript" src="js/ui/views/circuitview.js"></script>
    <script type="text/javascript" type="text/javascript">
        $(function() {
            var gridSize = 16;

        var circuit = new Circuit({
            width: Math.floor($("#workbench").width() / gridSize),
            height: Math.floor($("#workbench").height() / gridSize)
        });

        var v = new CircuitView({
            el: $("#workbench"),
            gridSize: gridSize,
            circuit: circuit
        });

        var endPosition;

        $(".gate").draggable({
            revert: true,
            revertDuration: 0,
            scroll: false,
            cursor: "pointer",
            helper: 'clone',
            zIndex: 1000,
            start: function(event, ui) { 
                $(this).draggable("option", "cursorAt", {
                    left: Math.round(ui.helper.width() / 2),
                    top: Math.round(ui.helper.height() / 2)
                }); 
                $(ui.helper).addClass("invalid");
            },
            drag: function(event, ui) {
                endPosition = {left: event.pageX, top: event.pageY};
            }
        });

        $("#workbench").droppable({ 
            accept: ".gate", 
            drop: function(event, ui) {
                circuit.addComponent(new Component({
                    x: Math.floor((endPosition.left - $("#workbench").offset().left) / gridSize), 
                    y: Math.floor((endPosition.top - $("#workbench").offset().top) / gridSize),
                    templateId: $(ui.helper).data("templateid")
                }));
           }, 
            over: function(event, ui) {
                $(ui.helper).removeClass("invalid");
            },
            out: function(event, ui) {
                $(ui.helper).addClass("invalid");
            }
        });
      });
    </script>

</head>

<body>
    <div class="fixed">
        <nav class="top-bar">
            <ul class="title-area">
                <li class="name"><h1><a href="#">GateSim</a></h1></li>
            </ul>

            <section class="top-bar-section">
                <ul class="left">
                    <li class="divider hide-for-small"></li>
                    <li class="has-dropdown">
                        <a href="#">Tutorials</a>
                        <ul class="dropdown">
                            <li><label>Starting Out</label></li>
                            <li><a href="#">Input and Output</a></li>
                            <li><a href="#">Binary Gates</a></li>
                            <li class="divider"></li>
                            <li><label>Making Progress</label></li>
                            <li><a href="#">Adders</a></li>
                            <li><a href="#">Memory</a></li>
                            <li class="divider"></li>
                        </ul>
                    </li>
                </ul>

                <ul class="right">
                    <li class="divider show-for-small"></li>
                    <li class="has-form">
                        <a class="button" href="#">Button!</a>
                    </li>
                </ul>
            </section>
        </nav>
    </div>

	<div class="row">
        <div class="large-2 columns sidebar sidebar-left">
            <div data-pane="pane-1" class="button dropdown slider" href="#">Basic Gates</div>
            <div id="pane-1" class="panel" style="display:none;">
                <div class="row">
                    <div data-templateid="and" class="large-6 columns gate"></div>
                    <div data-templateid="or" class="large-6 columns gate"></div>
                </div>
                <div class="row">
                    <div data-templateid="not" class="large-6 columns gate"></div>
                    <div data-templateid="xor" class="large-6 columns gate"></div>
                </div>
            </div>
            <div data-pane="pane-2" class="button dropdown slider" href="#">Composite Gates</div>
            <div id="pane-2" class="panel" style="display:none;"></div>
            <div data-pane="pane-3" class="button dropdown slider" href="#">Memory</div>
            <div id="pane-3" class="panel" style="display:none;"></div>
            <div data-pane="pane-4" class="button dropdown slider" href="#">Timing</div>
            <div id="pane-4" class="panel" style="display:none;"></div>
            <div data-pane="pane-5" class="button dropdown slider" href="#">Input/Output</div>
            <div id="pane-5" class="panel" style="display:none;"></div>
            <div data-pane="pane-6" class="button dropdown slider" href="#">Custom</div>
            <div id="pane-6" class="panel" style="display:none;"></div>
        </div>
        <div class="large-8 columns collpase">
            <canvas id="workbench"></div>
            <script type="text/javascript">
                $("#workbench").attr("width", $("#workbench").parent().innerWidth());
                $("#workbench").attr("height", $(window).height() - $(".top-bar").height());
            </script>
        </div>
        <div class="large-2 columns sidebar sidebar-right">
        </div>
	</div>

  <script>
    $(document).foundation();
  </script>
</body>
</html>

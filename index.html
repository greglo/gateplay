<!DOCTYPE html>
<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>GateSim</title>

    <link rel="stylesheet" href="css/foundation.css">
    <link rel="stylesheet" href="css/foundation-changes.css">


    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.10.3.custom.min.js"></script>
    <script type="text/javascript" src="js/zepto.js"></script>
    <script type="text/javascript" src="js/foundation.min.js"></script>
    <script type="text/javascript" src="js/fabric.js"></script>

    <script type="text/javascript">
      $( window ).resize(function() {
        $(".height-100").height($(window).height() - $(".top-bar").height());
      });
    </script>

    <script type="text/javascript">
      var canvas;

        //http://jsfiddle.net/fabricjs/S9sLu/

      $(function() {
        canvas = new fabric.Canvas('workbench', { selection: false });
        var grid = 50;

// create grid

        for (var i = 0; i < (600 / grid); i++) {
            canvas.add(new fabric.Line([ i * grid, 0, i * grid, 600], { stroke: '#ccc', selectable: false }));
            canvas.add(new fabric.Line([ 0, i * grid, 600, i * grid], { stroke: '#ccc', selectable: false }))
        }

// add objects

        canvas.add(new fabric.Rect({ 
          left: 100, 
          top: 100, 
          width: 50, 
          height: 50, 
          fill: '#faa', 
          originX: 'left', 
          originY: 'top',
          centeredRotation: true
        }));

        canvas.add(new fabric.Circle({ 
          left: 300, 
          top: 300, 
          radius: 50, 
          fill: '#9f9', 
          originX: 'left', 
          originY: 'top',
          centeredRotation: true
        }));

// snap to grid

        canvas.on('object:moving', function(options) { 
          options.target.set({
            left: Math.round(options.target.left / grid) * grid,
            top: Math.round(options.target.top / grid) * grid
          });
        });

        var lastMoved;

        $(".slider").click(function() {
          var pane = $("#" + $(this).data("pane"));

          if (typeof(lastMoved) === "undefined" || !lastMoved) {
            pane.slideDown("fast", function() {});
            lastMoved = pane;
          } else if (lastMoved.is(pane)) {
            lastMoved.slideUp("fast", function(){});
            lastMoved = null;
          } else {
            lastMoved.slideUp("fast", function(){});
            pane.slideDown("fast", function() {});
            lastMoved = pane;
          }
        });
    });
    </script>
  

    <script type="text/javascript" src="js/custom.modernizr.js"></script>
    <script type="text/javascript" src="js/underscore-min.js"></script>
    <script type="text/javascript" src="js/backbone-min.js"></script>
    <script type="text/javascript" src="js/backbone-min.js"></script>
    <script type="text/javascript" src="js/models/uigate.js"></script>
    <script type="text/javascript" src="js/collections/uigates.js"></script>
    <script type="text/javascript" src="js/views/uigateview.js"></script>
    <script type="text/javascript" src="js/views/uigatesview.js"></script>
    <script type="text/javascript" type="text/javascript">
        $(function() {
        var andGate = new UIGate({x: 100, y:100});

        var gates = new UIGates();

        var v = new UIGatesView({
            collection : gates
        });
        v.render();

        var endPosition;

        $(".gate").draggable({
            revert: true,
            revertDuration: 0,
            scroll: false,
            cursor: "pointer",
            helper: 'clone',
            zIndex: 1000,
            start: function(event, ui) { 
                $(this).draggable("option", "cursorAt", {
                    left: Math.round(ui.helper.width() / 2),
                    top: Math.round(ui.helper.height() / 2)
                }); 
                $(ui.helper).addClass("invalid");
            },
            drag: function(event, ui) {
                endPosition = {left: event.pageX, top: event.pageY};
            }
        });

        $("#workbench").droppable({ 
            accept: ".gate", 
            drop: function(event, ui) {
                gates.add({x: endPosition.left - $("#workbench").offset().left, y: endPosition.top - $("#workbench").offset().top});
           }, 
            over: function(event, ui) {
                console.log($(ui.helper).attr('class'));
                $(ui.helper).removeClass("invalid");
            },
            out: function(event, ui) {
                console.log($(ui.helper).attr('class'));
                $(ui.helper).addClass("invalid");
            }
        });
      });
    </script>

</head>

<body>
    <div class="fixed">
        <nav class="top-bar">
            <ul class="title-area">
                <li class="name"><h1><a href="#">GateSim</a></h1></li>
            </ul>

            <section class="top-bar-section">
                <ul class="left">
                    <li class="divider hide-for-small"></li>
                    <li class="has-dropdown">
                        <a href="#">Tutorials</a>
                        <ul class="dropdown">
                            <li><label>Starting Out</label></li>
                            <li><a href="#">Input and Output</a></li>
                            <li><a href="#">Binary Gates</a></li>
                            <li class="divider"></li>
                            <li><label>Making Progress</label></li>
                            <li><a href="#">Adders</a></li>
                            <li><a href="#">Memory</a></li>
                            <li class="divider"></li>
                        </ul>
                    </li>
                </ul>

                <ul class="right">
                    <li class="divider show-for-small"></li>
                    <li class="has-form">
                        <a class="button" href="#">Button!</a>
                    </li>
                </ul>
            </section>
        </nav>
    </div>

	<div class="row">
        <div class="large-2 columns sidebar sidebar-left">
            <div data-pane="pane-1" class="button dropdown slider" href="#">Basic Gates</div>
            <div id="pane-1" class="panel" style="display:none;">
                <div class="row">
                    <div id="and" class="large-6 columns gate"></div>
                    <div id="or" class="large-6 columns gate"></div>
                </div>
                <div class="row">
                    <div id="not" class="large-6 columns gate"></div>
                    <div id="xor" class="large-6 columns gate"></div>
                </div>
            </div>
            <div data-pane="pane-2" class="button dropdown slider" href="#">Composite Gates</div>
            <div id="pane-2" class="panel" style="display:none;"></div>
            <div data-pane="pane-3" class="button dropdown slider" href="#">Memory</div>
            <div id="pane-3" class="panel" style="display:none;"></div>
            <div data-pane="pane-4" class="button dropdown slider" href="#">Timing</div>
            <div id="pane-4" class="panel" style="display:none;"></div>
            <div data-pane="pane-5" class="button dropdown slider" href="#">Input/Output</div>
            <div id="pane-5" class="panel" style="display:none;"></div>
            <div data-pane="pane-6" class="button dropdown slider" href="#">Custom</div>
            <div id="pane-6" class="panel" style="display:none;"></div>
        </div>
        <div class="large-8 columns collpase">
            <canvas id="workbench" width="600" height="600"></div>
        </div>
        <div class="large-2 columns sidebar sidebar-right">
        </div>
	</div>

  <script>
    $(document).foundation();
  </script>
</body>
</html>
